<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-labs/workshops/react-springboot-Workshop/spring-rest-api--docker-aws-ecs-terraform-part-2" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.0">
<title data-rh="true">Deploy Spring REST API to AWS ECS Fargate - Terraform - Part-2 | CertifySphere</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://certifysphere.com/img/certifysphere_banner_social.png"><meta data-rh="true" name="twitter:image" content="https://certifysphere.com/img/certifysphere_banner_social.png"><meta data-rh="true" property="og:url" content="https://certifysphere.com/docs/labs/workshops/react-springboot-Workshop/spring-rest-api--docker-aws-ecs-terraform-part-2"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="AI software products, artificial intelligence, smart cafe solution, mindbloomers app, AI development, machine learning, coding bootcamp, react, python, aws, mongodb, postgres, AI consulting"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Deploy Spring REST API to AWS ECS Fargate - Terraform - Part-2 | CertifySphere"><meta data-rh="true" name="description" content="This chapter is a continuation of the previous chapter, Dockerized Java Spring Boot Rest API - Part-1. In the previous chapter, we completed several tasks to set up our environment for deploying our Spring Boot Rest API on AWS. These tasks included:"><meta data-rh="true" property="og:description" content="This chapter is a continuation of the previous chapter, Dockerized Java Spring Boot Rest API - Part-1. In the previous chapter, we completed several tasks to set up our environment for deploying our Spring Boot Rest API on AWS. These tasks included:"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://certifysphere.com/docs/labs/workshops/react-springboot-Workshop/spring-rest-api--docker-aws-ecs-terraform-part-2"><link data-rh="true" rel="alternate" href="https://certifysphere.com/docs/labs/workshops/react-springboot-Workshop/spring-rest-api--docker-aws-ecs-terraform-part-2" hreflang="en"><link data-rh="true" rel="alternate" href="https://certifysphere.com/docs/labs/workshops/react-springboot-Workshop/spring-rest-api--docker-aws-ecs-terraform-part-2" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="CertifySphere RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="CertifySphere Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TKWWQRV8GH"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-TKWWQRV8GH",{anonymize_ip:!0})</script>
<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-NL966CL8",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script><link rel="stylesheet" href="/assets/css/styles.b69b6beb.css">
<script src="/assets/js/runtime~main.6275a8aa.js" defer="defer"></script>
<script src="/assets/js/main.e311af08.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NL966CL8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">CertifySphere</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Products</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/products">All Products</a></li><li><a class="dropdown__link" href="/docs/products/mindbloomers">MindBloomers</a></li><li><a class="dropdown__link" href="/docs/products/smart-cafe">Smart Café Solution</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/learning">Learning Paths</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/certifysphere" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Chapter 5: Deploy Java Spring Boot Rest API Docker Container Image to AWS ECS Fargate with Terraform and Make Rest API URL Available with AWS ALB - Part-2</h1></header>
<p>This chapter is a continuation of the previous chapter, <a href="/docs/labs/workshops/react-springboot-Workshop/dockerized-spring-boot-rest-api"><strong>Dockerized Java Spring Boot Rest API - Part-1</strong></a>. In the previous chapter, we completed several tasks to set up our environment for deploying our Spring Boot Rest API on AWS. These tasks included:</p>
<ul>
<li>Creating an AWS Free Tier Account <a href="https://aws.amazon.com/free/" target="_blank" rel="noopener noreferrer">AWS Free Tier Account</a></li>
<li>Setting up an AWS IAM User and obtaining the Access and Secret Key <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users.html" target="_blank" rel="noopener noreferrer">AWS IAM User</a></li>
<li>Installing and configuring the AWS CLI <a href="https://aws.amazon.com/cli/" target="_blank" rel="noopener noreferrer">AWS CLI Documentation</a></li>
<li>Installing and configuring the Terraform CLI <a href="https://learn.hashicorp.com/tutorials/terraform/install-cli" target="_blank" rel="noopener noreferrer">Terraform Documentation</a></li>
<li>Installing Docker Desktop <a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener noreferrer">Docker Desktop Documentation</a></li>
<li>Dockerizing our Spring Boot application</li>
</ul>
<p>With these initial steps completed, we will now focus on deploying our Dockerized Java Spring Boot Rest API to AWS using the following technologies:</p>
<ul>
<li>AWS ECS Fargate (Elastic Container Service) <a href="https://aws.amazon.com/ecs/" target="_blank" rel="noopener noreferrer">AWS ECS Fargate Documentation</a></li>
<li>AWS Application Load Balancer <a href="https://aws.amazon.com/elasticloadbalancing/" target="_blank" rel="noopener noreferrer">AWS ALB Documentation</a></li>
<li>AWS ECR (Elastic Container Repository) <a href="https://aws.amazon.com/ecr/" target="_blank" rel="noopener noreferrer">AWS ECR Documentation</a></li>
<li>Terraform <a href="https://www.terraform.io/docs/index.html" target="_blank" rel="noopener noreferrer">Terraform Documentation</a></li>
<li>Docker <a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer">Docker Documentation</a></li>
</ul>
<p>By leveraging these technologies, we will be able to deploy our Spring Boot Rest API as a Docker container on AWS ECS Fargate, utilize an Application Load Balancer to distribute traffic, and leverage the Elastic Container Repository for storing our container images. We will use Terraform to provision and manage the infrastructure required for our deployment. Let&#x27;s continue with the next phase of our workshop and explore these technologies in detail!</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="build-docker-image-and-push-to-aws-ecr">Build Docker image and push to AWS ECR<a href="#build-docker-image-and-push-to-aws-ecr" class="hash-link" aria-label="Direct link to Build Docker image and push to AWS ECR" title="Direct link to Build Docker image and push to AWS ECR">​</a></h2>
<p>To build and push the Docker image for the Spring Boot application to an AWS ECR repository, you can create a <code>build.sh</code> file at the project root with the following script:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app_name=&quot;public-toilet-service&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws_region=&quot;us-east-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Build Maven project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mvn clean install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Build Docker image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker build -t $app_name .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Get AWS account number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws_account_number=$(aws sts get-caller-identity --query &quot;Account&quot; --output text)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Construct ECR repository URL and Docker image tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ecr_repository_url=&quot;${aws_account_number}.dkr.ecr.$aws_region.amazonaws.com/$app_name&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker_image_tag=&quot;v1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Log in to AWS ECR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">login_status=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while [[ $login_status -ne 0 ]]; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    aws ecr get-login-password --region $aws_region | docker login --username AWS --password-stdin ${aws_account_number}.dkr.ecr.$aws_region.amazonaws.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    login_status=$?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sleep 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check if ECR repository exists and create it if it doesn&#x27;t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ! aws ecr describe-repositories --region $aws_region --repository-names $app_name &gt;/dev/null 2&gt;&amp;1; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    aws ecr create-repository --region $aws_region --repository-name $app_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Tag Docker image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker tag $app_name:latest $ecr_repository_url:$docker_image_tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Push Docker image to ECR repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker push $ecr_repository_url:$docker_image_tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Docker image pushed to ECR repository: $ecr_repository_url:$docker_image_tag&quot;</span><br></span></code></pre></div></div>
<p>This script performs the following steps:</p>
<ol>
<li>
<p>Sets the variables:</p>
<ul>
<li><code>app_name</code>: The name of the Spring Boot application.</li>
<li><code>aws_region</code>: The AWS region where the ECR repository is located.</li>
</ul>
</li>
<li>
<p>Builds the Maven project using <code>mvn clean install</code>.</p>
</li>
<li>
<p>Builds the Docker image for the Spring Boot application using <code>docker build</code>, tagging it with the <code>$app_name</code> variable.</p>
</li>
<li>
<p>Retrieves the AWS account number by executing the <code>aws sts get-caller-identity</code> command and extracting the account number from the output.</p>
</li>
<li>
<p>Constructs the ECR repository URL by combining the AWS account number, AWS region, and <code>$app_name</code>. Sets the Docker image tag as <code>v1</code>.</p>
</li>
<li>
<p>Logs in to the AWS ECR repository using <code>aws ecr get-login-password</code> to retrieve an authentication token and <code>docker login</code> to log in with the token.</p>
</li>
<li>
<p>Checks if the ECR repository already exists using <code>aws ecr describe-repositories</code> and creates it with <code>aws ecr create-repository</code> if it doesn&#x27;t exist.</p>
</li>
<li>
<p>Tags the Docker image with the ECR repository URL and Docker image tag using <code>docker tag</code>.</p>
</li>
<li>
<p>Pushes the Docker image to the ECR repository using <code>docker push</code>.</p>
</li>
<li>
<p>Prints a success message indicating that the Docker image has been pushed to the ECR repository, displaying the ECR repository URL and Docker image tag.</p>
</li>
</ol>
<p>You can execute the <code>build.sh</code> script to build and push the Docker image to your AWS ECR repository. Make sure you have the necessary AWS credentials and permissions configured for successful execution.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="terraform----build-aws-ecs-infrastructure-and-deploy-docker-image">Terraform -  Build AWS ECS Infrastructure and Deploy Docker Image<a href="#terraform----build-aws-ecs-infrastructure-and-deploy-docker-image" class="hash-link" aria-label="Direct link to Terraform -  Build AWS ECS Infrastructure and Deploy Docker Image" title="Direct link to Terraform -  Build AWS ECS Infrastructure and Deploy Docker Image">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-1-terraform---set-up-aws-vpc-and-other-networking">Step 1: Terraform - Set up AWS VPC and other networking<a href="#step-1-terraform---set-up-aws-vpc-and-other-networking" class="hash-link" aria-label="Direct link to Step 1: Terraform - Set up AWS VPC and other networking" title="Direct link to Step 1: Terraform - Set up AWS VPC and other networking">​</a></h3>
<p>To set up the AWS VPC and other networking components using Terraform, follow these steps:</p>
<ol>
<li>
<p>In your SpringBoot Service (<code>public-toilet-service</code>) project root directory, create a new directory named <code>terraform</code>.</p>
</li>
<li>
<p>Inside the <code>terraform</code> directory, create a new file named <code>main.tf</code> and open it in a text editor (such as VSCode).</p>
</li>
<li>
<p>Add the following content to the <code>main.tf</code> file:</p>
</li>
</ol>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Define the provider for AWS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">provider &quot;aws&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  region = var.region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data &quot;aws_availability_zones&quot; &quot;available&quot; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">locals {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  azs = slice(data.aws_availability_zones.available.names, 0, 3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AppName = var.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module &quot;vpc&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source                 = &quot;terraform-aws-modules/vpc/aws&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                   = var.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cidr                   = var.cidr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  azs                    = local.azs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private_subnets        = var.private_subnets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public_subnets         = var.public_subnets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags                   = local.tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enable_nat_gateway     = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  single_nat_gateway     = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  one_nat_gateway_per_az = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enable_vpn_gateway     = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enable_dns_hostnames   = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enable_dns_support     = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Let&#x27;s go through the content of the <code>main.tf</code> file:</p>
<ol>
<li>
<p>Provider Configuration: The <code>provider</code> block specifies the AWS provider and sets the <code>region</code> parameter based on the <code>var.region</code> input variable.</p>
</li>
<li>
<p>Data Blocks: Three <code>data</code> blocks are used to gather information about the AWS environment:</p>
<p>a. <code>aws_availability_zones</code> data block retrieves the available availability zones in the selected region.</p>
</li>
<li>
<p>Locals Block: The <code>locals</code> block defines local variables used within the configuration:</p>
<p>a. The <code>azs</code> variable slices the list of available availability zones to the first three.</p>
<p>b. The <code>tags</code> variable defines a map of tags, including the <code>AppName</code> tag with the value of the <code>var.name</code> input variable.</p>
</li>
<li>
<p>VPC Module: The <code>module</code> block declares the use of the VPC module provided by the <code>terraform-aws-modules/vpc/aws</code> source. The module is instantiated with various input variables:</p>
<ul>
<li><code>name</code>: The name of the VPC.</li>
<li><code>cidr</code>: The CIDR block for the VPC.</li>
<li><code>azs</code>: The availability zones where subnets will be created.</li>
<li><code>private_subnets</code>: A list of CIDR blocks for private subnets.</li>
<li><code>public_subnets</code>: A list of CIDR blocks for public subnets.</li>
<li><code>tags</code>: Tags to be applied to the VPC resources.</li>
<li><code>enable_nat_gateway</code>: Whether to create a NAT gateway for private subnets.</li>
<li><code>single_nat_gateway</code>: Whether to use a single NAT gateway for all private subnets.</li>
<li><code>one_nat_gateway_per_az</code>: Whether to use one NAT gateway per availability zone.</li>
<li><code>enable_vpn_gateway</code>: Whether to create a VPN gateway for the VPC.</li>
<li><code>enable_dns_hostnames</code>: Whether to enable DNS hostnames for the VPC.</li>
<li><code>enable_dns_support</code>: Whether to enable DNS support for the VPC.</li>
</ul>
</li>
</ol>
<p>The provided <code>main.tf</code> file sets up the VPC infrastructure using the VPC module. You can further customize this file and add more resources or configurations as per your project requirements.</p>
<p>Please note that you may need to update the values of the input variables (<code>var.region</code>, <code>var.name</code>,</p>
<p><code>var.cidr</code>, <code>var.private_subnets</code>, <code>var.public_subnets</code>) in the file based on your specific configuration.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-2-ecs-and-alb-terraform-configurations">Step 2: ECS and ALB terraform configurations<a href="#step-2-ecs-and-alb-terraform-configurations" class="hash-link" aria-label="Direct link to Step 2: ECS and ALB terraform configurations" title="Direct link to Step 2: ECS and ALB terraform configurations">​</a></h3>
<p>Add a new file <code>fargate.tf</code> inside <code>terraform</code> folder</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Create an ECS cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data &quot;aws_ecr_repository&quot; &quot;my_ecr_repo&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name = var.ecr_repo_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">locals {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  task_image = &quot;${data.aws_ecr_repository.my_ecr_repo.repository_url}:v1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cw_log_group = &quot;/ecs/${var.name}&quot; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  container_definition = [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cpu         = 512</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image       = local.task_image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    memory      = 1024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name        = var.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    networkMode = &quot;awsvpc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    portMappings = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol      = &quot;tcp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        containerPort = var.container_port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hostPort      = var.container_port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logConfiguration = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      logdriver = &quot;awslogs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      options = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;awslogs-group&quot;         = local.cw_log_group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;awslogs-region&quot;        = data.aws_region.current.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;awslogs-stream-prefix&quot; = &quot;stdout&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ECS Task and Service Security Group, IAM Policy and Roles.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_security_group&quot; &quot;fargate_task&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name   = &quot;${var.name}-fargate-task-sg&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vpc_id = module.vpc.vpc_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ingress {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from_port   = var.container_port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_port     = var.container_port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol    = &quot;tcp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cidr_blocks = [module.vpc.vpc_cidr_block]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  egress {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from_port   = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_port     = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol    = &quot;-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cidr_blocks = [&quot;0.0.0.0/0&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data &quot;aws_iam_policy_document&quot; &quot;fargate-role-policy&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  statement {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    actions = [&quot;sts:AssumeRole&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    principals {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      type        = &quot;Service&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      identifiers = [&quot;ecs.amazonaws.com&quot;, &quot;ecs-tasks.amazonaws.com&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_iam_policy&quot; &quot;fargate_execution&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name   = &quot;${var.name}-fargate_execution_policy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  policy = &quot;${file(&quot;fargateExecutionIAMPolicy.json&quot;)}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_iam_policy&quot; &quot;fargate_task&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name   = &quot;${var.name}-fargate_task_policy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  policy = &quot;${file(&quot;fargateTaskIAMPolicy.json&quot;)}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_iam_role&quot; &quot;fargate_execution&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name               = &quot;${var.name}-fargate-execution-role&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  assume_role_policy = data.aws_iam_policy_document.fargate-role-policy.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_iam_role&quot; &quot;fargate_task&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name               = &quot;${var.name}-fargate-task-role&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  assume_role_policy = data.aws_iam_policy_document.fargate-role-policy.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_iam_role_policy_attachment&quot; &quot;fargate-execution&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  role       = aws_iam_role.fargate_execution.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  policy_arn = aws_iam_policy.fargate_execution.arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_iam_role_policy_attachment&quot; &quot;fargate-task&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  role       = aws_iam_role.fargate_task.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  policy_arn = aws_iam_policy.fargate_task.arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#CloudWatch Log </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_cloudwatch_log_group&quot; &quot;app&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name = local.cw_log_group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#ECS CLuster, Task and Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_ecs_cluster&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name = &quot;${var.name}-ecs-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_ecs_task_definition&quot; &quot;app&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  family                   = &quot;${var.name}-task-family&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network_mode             = &quot;awsvpc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cpu                      = local.container_definition.0.cpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  memory                   = local.container_definition.0.memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  requires_compatibilities = [&quot;FARGATE&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  container_definitions    = jsonencode(local.container_definition)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  execution_role_arn       = aws_iam_role.fargate_execution.arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  task_role_arn            = aws_iam_role.fargate_task.arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_ecs_service&quot; &quot;app&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name            = &quot;${var.name}-svc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cluster         = aws_ecs_cluster.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  task_definition = aws_ecs_task_definition.app.arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  desired_count   = var.service_desired_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  launch_type     = &quot;FARGATE&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  load_balancer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target_group_arn = aws_lb_target_group.my_target_group.arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_name   = var.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_port   = var.container_port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network_configuration {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    security_groups = [aws_security_group.fargate_task.id]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subnets         = module.vpc.private_subnets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#Public Load Balancer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_security_group&quot; &quot;alb&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name   = &quot;${var.name}-alb-sg&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vpc_id = module.vpc.vpc_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ingress {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol         = &quot;tcp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from_port        = 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_port          = 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cidr_blocks      = [&quot;0.0.0.0/0&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ipv6_cidr_blocks = [&quot;::/0&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ingress {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol         = &quot;tcp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from_port        = 443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_port          = 443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cidr_blocks      = [&quot;0.0.0.0/0&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ipv6_cidr_blocks = [&quot;::/0&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  egress {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol         = &quot;-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from_port        = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_port          = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cidr_blocks      = [&quot;0.0.0.0/0&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ipv6_cidr_blocks = [&quot;::/0&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create a load balancer target group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_lb_target_group&quot; &quot;my_target_group&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name        = &quot;${var.name}-target-group&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port        = 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  protocol    = &quot;HTTP&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vpc_id      = module.vpc.vpc_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  target_type = &quot;ip&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  health_check {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enabled = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path    = var.health_check_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create a load balancer listener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_lb_listener&quot; &quot;my_listener&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  load_balancer_arn = aws_lb.my_load_balancer.arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port              = 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  protocol          = &quot;HTTP&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default_action {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target_group_arn = aws_lb_target_group.my_target_group.arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type             = &quot;forward&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># # Create a load balancer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_lb&quot; &quot;my_load_balancer&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name               = &quot;${var.name}-load-balancer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  load_balancer_type = &quot;application&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subnets            = module.vpc.public_subnets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  security_groups    = [aws_security_group.alb.id]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>The <code>fargate.tf</code> file contains the following:</p>
<ol>
<li>
<p>Data Block: It fetches information about the ECR repository specified in the <code>var.ecr_repo_name</code> input variable.</p>
</li>
<li>
<p>Locals Block: It defines local variables used within the configuration.</p>
</li>
</ol>
<ul>
<li><code>task_image</code> variable specifies the image URI from the ECR repository.</li>
<li><code>cw_log_group</code> variable specifies the CloudWatch log group name.</li>
<li><code>container_definition</code> variable contains the definition for the ECS container, including CPU, memory, networking, port mappings, and log configuration.</li>
</ul>
<ol start="3">
<li>
<p>AWS Security Group: It creates a security group for the Fargate task, allowing ingress traffic on the specified container port and egress traffic to any destination.</p>
</li>
<li>
<p>AWS IAM Role and Policy: It creates IAM roles, policies, and role-policy attachments for Fargate execution and task roles.</p>
</li>
<li>
<p>AWS CloudWatch Log Group: It creates a CloudWatch log group for logging.</p>
</li>
<li>
<p>AWS ECS Cluster, Task Definition, and Service: These resources create an ECS cluster, task definition, and service for the Fargate deployment. The task definition references the container definition, execution role, and task role.</p>
</li>
<li>
<p>AWS ECS Service Load Balancer: It configures the load balancer for the ECS service, including the target group and network configuration.</p>
</li>
<li>
<p>Public Load Balancer: It creates a security group for the Application Load Balancer (ALB) allowing ingress traffic on ports 80 and 443 and egress traffic to any destination.</p>
</li>
<li>
<p>Load Balancer Target Group and Listener: It creates a target group and listener for the ALB to route traffic to the ECS service.</p>
</li>
<li>
<p>Load Balancer: It creates an Application Load Balancer and associates it with the specified subnets and security groups.</p>
</li>
</ol>
<p>The provided <code>fargate.tf</code> file sets up the ECS Fargate deployment with an ALB for load balancing. Additional resources and configurations can be added as needed for your specific project.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-3-terraform-veriables">Step 3: Terraform Veriables<a href="#step-3-terraform-veriables" class="hash-link" aria-label="Direct link to Step 3: Terraform Veriables" title="Direct link to Step 3: Terraform Veriables">​</a></h3>
<p>Create a new file named variables.tf inside the terraform directory. This file will store the default values for all the configurations used in other Terraform scripts. These settings can be overridden with different values if needed.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;the name of your stack or application.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;public-toilet&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;ecr_repo_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;the ECR Repository Name&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;public-toilet-service&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;region&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;the AWS region in which resources are created.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;us-east-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;cidr&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The CIDR block for the VPC.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;10.0.0.0/16&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;private_subnets&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;a list of CIDRs for private subnets in your VPC, must be set if the cidr variable is defined, needs to have as many elements as there are availability zones&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = [&quot;10.0.1.0/24&quot;, &quot;10.0.2.0/24&quot;, &quot;10.0.3.0/24&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;public_subnets&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;a list of CIDRs for public subnets in your VPC, must be set if the cidr variable is defined, needs to have as many elements as there are availability zones&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = [&quot;10.0.101.0/24&quot;, &quot;10.0.102.0/24&quot;, &quot;10.0.103.0/24&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;health_check_path&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Health Check path for load balancer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;/actuator/health&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;container_port&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The port where the Docker is exposed&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;service_desired_count&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Desired Number of tasks running in parallel&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>The <code>variables.tf</code> file contains the following variables:</p>
<ol>
<li>
<p><code>name</code>: The name of your stack or application. It has a default value of &quot;public-toilet&quot;.</p>
</li>
<li>
<p><code>ecr_repo_name</code>: The name of the ECR repository. It has a default value of &quot;public-toilet-service&quot;.</p>
</li>
<li>
<p><code>region</code>: The AWS region in which resources are created. It has a default value of &quot;us-east-1&quot;.</p>
</li>
<li>
<p><code>cidr</code>: The CIDR block for the VPC. It has a default value of &quot;10.0.0.0/16&quot;.</p>
</li>
<li>
<p><code>private_subnets</code>: A list of CIDRs for private subnets in your VPC. It must be set if the <code>cidr</code> variable is defined and needs to have as many elements as there are availability zones. It has a default value of [&quot;10.0.1.0/24&quot;, &quot;10.0.2.0/24&quot;, &quot;10.0.3.0/24&quot;].</p>
</li>
<li>
<p><code>public_subnets</code>: A list of CIDRs for public subnets in your VPC. It must be set if the <code>cidr</code> variable is defined and needs to have as many elements as there are availability zones. It has a default value of [&quot;10.0.101.0/24&quot;, &quot;10.0.102.0/24&quot;, &quot;10.0.103.0/24&quot;].</p>
</li>
<li>
<p><code>health_check_path</code>: The health check path for the load balancer. It has a default value of &quot;/actuator/health&quot;.</p>
</li>
<li>
<p><code>container_port</code>: The port where the Docker container is exposed. It has a default value of 8080.</p>
</li>
<li>
<p><code>service_desired_count</code>: The desired number of tasks running in parallel. It has a default value of 2.</p>
</li>
</ol>
<p>The variables.tf file defines the variables used in your Terraform configuration with their default values. You can override these values by specifying them in a terraform.tfvars file or by passing them directly as command-line arguments when running Terraform commands.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-4--terraform-output-file-configuration">Step 4:  Terraform output file Configuration<a href="#step-4--terraform-output-file-configuration" class="hash-link" aria-label="Direct link to Step 4:  Terraform output file Configuration" title="Direct link to Step 4:  Terraform output file Configuration">​</a></h3>
<p>Create a new file named outputs.tf inside the terraform directory.</p>
<p>In Terraform, modules and resources can provide output values once AWS resources are provisioned. These output values can be printed or used in other modules or scripts.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;vpc_id&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The ID of the VPC&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = module.vpc.vpc_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;vpc_arn&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The ARN of the VPC&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = module.vpc.vpc_arn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;vpc_cidr_block&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The CIDR block of the VPC&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = module.vpc.vpc_cidr_block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;private_subnets&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;List of IDs of private subnets&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = module.vpc.private_subnets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;public_subnets&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;List of IDs of public subnets&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = module.vpc.public_subnets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># # Output the load balancer DNS name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;load_balancer_dns_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value = aws_lb.my_load_balancer.dns_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>The <code>output.tf</code> file contains the following:</p>
<ol>
<li>VPC Outputs:</li>
</ol>
<ul>
<li><code>vpc_id</code>: The ID of the VPC.</li>
<li><code>vpc_arn</code>: The ARN of the VPC.</li>
<li><code>vpc_cidr_block</code>: The CIDR block of the VPC.</li>
<li><code>private_subnets</code>: A list of IDs of private subnets.</li>
<li><code>public_subnets</code>: A list of IDs of public subnets.</li>
</ul>
<ol start="2">
<li>Load Balancer Output:</li>
</ol>
<ul>
<li><code>load_balancer_dns_name</code>: The DNS name of the load balancer.</li>
</ul>
<p>These outputs allow you to retrieve and reference important information from the Terraform deployment. For example, you can use the VPC ID or load balancer DNS name in subsequent steps or other parts of your infrastructure.</p>
<p>By defining these outputs, you can easily access the values after running <code>terraform apply</code> to see the specific details about your deployed resources.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-5-initialize-and-apply-terraform-configuration">Step 5: Initialize and Apply Terraform Configuration<a href="#step-5-initialize-and-apply-terraform-configuration" class="hash-link" aria-label="Direct link to Step 5: Initialize and Apply Terraform Configuration" title="Direct link to Step 5: Initialize and Apply Terraform Configuration">​</a></h3>
<ol>
<li>Open a terminal or command prompt.</li>
<li>Navigate to the <code>terraform</code> directory inside your Spring app project directory.</li>
<li>Initialize the Terraform configuration by running the following command:</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">terraform init</span><br></span></code></pre></div></div>
<ol start="4">
<li>Apply the Terraform configuration to create the AWS resources by running the</li>
</ol>
<p>following command:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">terraform apply</span><br></span></code></pre></div></div>
<ol start="5">
<li>Review the changes that Terraform will make and type &quot;yes&quot; to confirm the deployment.</li>
</ol>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-6-test-the-api-endpoints">Step 6: Test the API Endpoints<a href="#step-6-test-the-api-endpoints" class="hash-link" aria-label="Direct link to Step 6: Test the API Endpoints" title="Direct link to Step 6: Test the API Endpoints">​</a></h3>
<p>After successfully applying the Terraform configuration, AWS ECS and ALB resources will be provisioned, and your Spring Boot app container image will be deployed as an ECS task. Follow the steps below to test the API endpoints:</p>
<ol>
<li>
<p>Look for the LoadBalancer URL (<code>load_balancer_dns_name</code>) in the Terraform outputs. This URL will be provided as the endpoint to access your application.</p>
</li>
<li>
<p>Test all CRUD operations in the Spring Boot REST API as we did in <a href="/docs/labs/workshops/react-springboot-Workshop/springboot-rest-services-part-2#rest-api-testing">Chapter 2: Building a Spring Boot Backend REST API for CRUD Operations - Part 2</a>. Replace the <code>http://localhost:8080</code> part of the URL with the load balancer URL copied from the Terraform output.</p>
</li>
</ol>
<p>This will allow you to interact with your Spring Boot API through the LoadBalancer URL provided by AWS.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-7-clean-up-aws-resources">Step 7: Clean Up AWS Resources<a href="#step-7-clean-up-aws-resources" class="hash-link" aria-label="Direct link to Step 7: Clean Up AWS Resources" title="Direct link to Step 7: Clean Up AWS Resources">​</a></h3>
<p>When you no longer need the AWS resources created by Terraform, it&#x27;s important to clean them up to avoid unnecessary costs. Follow the steps below to clean up your AWS resources:</p>
<ol>
<li>
<p>Open a terminal or command prompt.</p>
</li>
<li>
<p>Navigate to the directory where your Terraform configuration files are located.</p>
</li>
<li>
<p>Run the following command to destroy the AWS resources created by Terraform:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">terraform destroy</span><br></span></code></pre></div></div>
<p>You may be prompted to confirm the destruction of resources. Type <code>yes</code> and press Enter to proceed.</p>
</li>
<li>
<p>Terraform will begin destroying the provisioned resources. Wait for the process to complete.</p>
<p><strong>Note:</strong> Keep in mind that destroying resources is an irreversible action, and all data associated with the resources will be lost.</p>
</li>
</ol>
<p>By performing the above steps, you will clean up the AWS resources provisioned by Terraform, ensuring that you are not billed for resources you no longer need.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="github-repository">GitHub Repository<a href="#github-repository" class="hash-link" aria-label="Direct link to GitHub Repository" title="Direct link to GitHub Repository">​</a></h2>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>You can refer to and clone the code up to this section from the <a href="https://github.com/certifysphere/workshops.git" target="_blank" rel="noopener noreferrer"><strong>GitHub Repository</strong></a> using the <code>with-service-docker-image-to-ecs</code> branch.</p><p>To clone the repository, use the following command:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone --branch with-service-docker-image-to-ecs https://github.com/certifysphere/workshops.git</span><br></span></code></pre></div></div><p>This command will clone the repository and checkout the <code>with-service-docker-image-to-ecs</code> branch, which contains the code up to this section of the workshop.</p><p>Navigate to the <code>public-toilets-app</code> directory to access the app code:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd workshops/reactjs-springboot-workshop/public-toilets-app/</span><br></span></code></pre></div></div><p>From there, you can explore the code and continue with the workshop.</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/spring-boot">Spring Boot</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/rest-services">Rest Services</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/aws-ecs">AWS ECS</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/aws-ecr">AWS ECR</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/application-load-balancer">Application Load Balancer</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/docker">Docker</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/terraform">Terraform</a></li></ul></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#build-docker-image-and-push-to-aws-ecr" class="table-of-contents__link toc-highlight">Build Docker image and push to AWS ECR</a></li><li><a href="#terraform----build-aws-ecs-infrastructure-and-deploy-docker-image" class="table-of-contents__link toc-highlight">Terraform -  Build AWS ECS Infrastructure and Deploy Docker Image</a><ul><li><a href="#step-1-terraform---set-up-aws-vpc-and-other-networking" class="table-of-contents__link toc-highlight">Step 1: Terraform - Set up AWS VPC and other networking</a></li><li><a href="#step-2-ecs-and-alb-terraform-configurations" class="table-of-contents__link toc-highlight">Step 2: ECS and ALB terraform configurations</a></li><li><a href="#step-3-terraform-veriables" class="table-of-contents__link toc-highlight">Step 3: Terraform Veriables</a></li><li><a href="#step-4--terraform-output-file-configuration" class="table-of-contents__link toc-highlight">Step 4:  Terraform output file Configuration</a></li><li><a href="#step-5-initialize-and-apply-terraform-configuration" class="table-of-contents__link toc-highlight">Step 5: Initialize and Apply Terraform Configuration</a></li><li><a href="#step-6-test-the-api-endpoints" class="table-of-contents__link toc-highlight">Step 6: Test the API Endpoints</a></li><li><a href="#step-7-clean-up-aws-resources" class="table-of-contents__link toc-highlight">Step 7: Clean Up AWS Resources</a></li></ul></li><li><a href="#github-repository" class="table-of-contents__link toc-highlight">GitHub Repository</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Products</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/products">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/products/mindbloomers">MindBloomers</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/products/smart-cafe">Smart Café Solution</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learning</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/learning">Learning Paths</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learning/programming">Programming</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learning/cloud-devops">Cloud &amp; DevOps</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learning/ai-ml">AI &amp; ML</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/certifysphere" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:contact@certifysphere.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/privacy-policy">Privacy Policy</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/terms-of-service">Terms of Service</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/products/mindbloomers-privacy-policy">MindBloomers Privacy</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/products/smart-cafe/privacy-policy">Smart Café Privacy</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 CertifySphere Solutions LLC. All rights reserved.</div></div></div></footer></div>
</body>
</html>